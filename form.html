<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Attendance Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
    body { background-color: #121212; color: #ffffff; overflow-x: hidden; }
    #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #121212; display: flex; align-items: center; justify-content: center; z-index: 9999; transition: all 0.5s ease; }
    #preloader.fade-out { opacity: 0; transform: scale(0); pointer-events: none; }
    .spinner { border: 4px solid #ccc; border-top: 4px solid rgba(30, 144, 255, 0.5); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0); } 100% { transform: rotate(360deg); } }
    header { display: flex; align-items: center; gap: 1rem; padding: 0.6rem 1.5rem; background-color: #1a1a1a; }
    .logo-container { background: white; border-radius: 8px; padding: 4px; }
    .logo-container img { height: 40px; width: auto; }
    h1 { font-size: 1.2rem; }
    main { position: relative; z-index: 1; padding: 2rem; text-align: center; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transform: translateX(-20px); transition: opacity 1s ease, transform 1s ease; }
    main.visible { opacity: 1; transform: translateX(0); }
    main::before { content: ""; background-image: url('python-blog-image.jpg'); background-size: cover; background-position: center; position: absolute; inset: 0; z-index: -2; opacity: 0.25; filter: brightness(0.6); }
    main::after { content: ""; position: absolute; inset: 0; background: radial-gradient(ellipse at center, rgba(0,0,0,0) 40%, rgba(0,0,0,0.9) 100%); z-index: -1; }
    form { background-color: rgba(0,0,0,0.6); padding: 2rem; border-radius: 12px; max-width: 600px; width: 100%; margin: 2rem auto; box-shadow: 0 0 20px rgba(0,0,0,0.4); text-align: left; }
    label { display: block; margin: 1rem 0 0.5rem; }
    input[type="text"], input[type="checkbox"] { width: 100%; padding: 0.7rem; border-radius: 8px; border: none; background-color: #222; color: white; }
    input[readonly] { background-color: #333; }
    button { margin-top: 1rem; width: 100%; padding: 0.8rem; border: none; border-radius: 8px; background-color: #4fc3f7; color: #000; font-weight: bold; cursor: pointer; }
    button:hover { background-color: #03a9f4; }
    .hidden { display: none; }
    .error { color: red; font-size: 0.9rem; }

    .custom-dropdown {
      position: relative; user-select: none;
    }
    .dropdown-selected {
      padding: 0.7rem; background-color: #222; color: white; border-radius: 8px; cursor: pointer; border: none;
    }
    .dropdown-options {
      position: absolute; top: 100%; left: 0; right: 0; max-height: 0;
      overflow-y: hidden; background-color: #222; border: 1px solid #444; border-radius: 8px;
      z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.5); opacity: 0;
      transition: max-height 0.3s ease, opacity 0.3s ease; scroll-behavior: smooth;
    }
    .dropdown-options.show {
      max-height: 200px; opacity: 1; overflow-y: auto;
    }
    .dropdown-options div {
      padding: 0.7rem; cursor: pointer; transition: background 0.2s ease;
    }
    .dropdown-options div:hover {
      background-color: #333;
    }

    footer { background-color: #1a1a1a; color: white; padding: 2rem; text-align: center; }
    .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1.5rem; margin-bottom: 1rem; text-align: left; }
    .footer-section h4 { font-size: 0.9rem; margin-bottom: 0.5rem; }
    .footer-section ul { list-style: none; padding: 0; font-size: 0.8rem; }
    .footer-section li { margin-bottom: 4px; }
    .footer-section a { color: #ccc; text-decoration: none; font-size: 0.8rem; }
    .footer-divider { height: 1px; background: #444; margin: 1rem 0; opacity: 0.4; }
    .footer-bottom { font-size: 0.75rem; text-align: center; margin-top: 1rem; }
  </style>
</head>
<body oncontextmenu="return false">
<div id="preloader"><div class="spinner"></div></div>

<header>
  <div class="logo-container"><img src="logo-512x512-1.png" alt="DAV Logo"></div>
  <h1>D.A.V. College Jalandhar</h1>
</header>

<main id="main-content">
  <form id="attendanceForm" method="POST" action="https://script.google.com/macros/s/AKfycbxSVOE1_zV-N_fFAi6U1i-cRD6zObrb_1MlFsbNkJd-ps8xCzq7-OcNZBPJKaymNk-rNg/exec" target="hidden_iframe">
    <h2>Attendance Form</h2>

    <label for="code">Security Code</label>
    <input type="text" id="code" maxlength="3" required>
    <div id="codeError" class="error hidden">Invalid code. Please try again.</div>

    <label for="roll">Roll Number</label>
    <div class="custom-dropdown" id="customDropdown">
      <div class="dropdown-selected" id="dropdownSelected">Select Roll Number</div>
      <div class="dropdown-options" id="dropdownOptions"></div>
      <input type="hidden" id="roll" name="roll" required />
    </div>

    <label for="name">Name</label>
    <input type="text" id="name" name="name" readonly required>

    <label><input type="checkbox" id="confirm" required> I confirm that I am present.</label>
    <button type="submit">Submit Attendance</button>
  </form>
</main>
<iframe name="hidden_iframe" style="display:none;"></iframe>

<footer>
  <div class="footer-content">
    <div class="footer-section"><h4>Quick Links</h4><ul><li><a href="#">Attendance Policy</a></li></ul></div>
    <div class="footer-section"><h4>Social Media</h4><ul><li><a href="https://www.youtube.com/@nischaybahl7714" target="_blank">YouTube</a></li></ul></div>
    <div class="footer-section"><h4>Contact</h4><ul><li><a href="mailto:bca25.28.dav@gmail.com">bca25.28.dav@gmail.com</a></li></ul></div>
    <div class="footer-section"><h4>Address</h4><ul><li>D.A.V. College, Mahatma Hansraj Marg,<br>Jalandhar, Punjab – 144008, India</li></ul></div>
  </div>
  <div class="footer-divider"></div>
  <div class="footer-bottom">© 2025 | Credits: Prabhsimranjot Singh, BCA (FCA-1)</div>
</footer>

<script>
  const rollToName = {
    "1": "CHIRAG RANA", "2": "SHARANJIT SINGH", "3": "ANEESH KUMAR", "4": "JATINVEER", "5": "SOHAN KUMAR",
    "6": "TUSHAR", "7": "VANSH SHARMA", "8": "SAGAR KUMAR MANDAL", "9": "MEHAK", "10": "MANREET KAUR",
    "11": "ARUSHI", "12": "MANNAT", "13": "SURAJ SINGH", "14": "DIPANKAR", "15": "SNEHA",
    "16": "NAVJOT KAUR", "17": "ADITYA SHARMA", "18": "ROHAN", "19": "DAMANJEET", "20": "SHIVAM PANDEY",
    "21": "NITIN", "22": "NIKHIL", "23": "AARUSHI MALHOTRA", "24": "ANKIT KUMAR", "25": "EKAMJEET KAUR KALRA",
    "26": "SHIVAM", "27": "PRABHSIMRANJOT SINGH", "28": "SUMANT SHARMA", "29": "HARSHIT", "30": "NAMPREET SINGH",
    "31": "TANUSH", "32": "PARTH AULUCK", "33": "TANISH JAIN", "34": "PALAK BHARDWAJ", "35": "AKASH DEEP",
    "36": "AYUSH KUMAR", "37": "LAKSH", "38": "JASHAN ARORA", "39": "KRISHAN SINGH", "40": "KULWINDER KAUR",
    "41": "DAKSH CHAUHAN", "42": "DIWAKAR", "43": "SARUCHI SHARMA", "44": "AMRITPAL SINGH", "45": "GLORY",
    "46": "SIMRAN", "47": "MANIK", "48": "OM TALWAR", "49": "NITIN KUMARN BASRA", "50": "KHUSHI",
    "52": "KUNAL BHAGAT", "53": "JATIN GILHOTRA", "54": "LAKSH KALIA", "55": "LAKSHAY JOSHI", "56": "MAANSHU DUBEY",
    "57": "PREET LOI", "58": "KARAN SINGH", "59": "VIBHOR JAIN", "60": "UTKARSHA RAJ SINGH", "61": "MEHAK", "62": "NIKHIL"
  };

  function getSecurityCode() {
  const schedule = [
    { date: "29/07/2025", period: 1, code: "843" },
    { date: "29/07/2025", period: 2, code: "612" },
    { date: "30/07/2025", period: 1, code: "205" },
    { date: "30/07/2025", period: 2, code: "476" },
    { date: "30/07/2025", period: 3, code: "713" },
    { date: "31/07/2025", period: 1, code: "999" },
    { date: "31/07/2025", period: 2, code: "350" },
    { date: "31/07/2025", period: 3, code: "124" },
    { date: "01/08/2025", period: 1, code: "892" },
    { date: "01/08/2025", period: 2, code: "673" },
    { date: "01/08/2025", period: 3, code: "431" },
    { date: "02/08/2025", period: 1, code: "288" },
    { date: "02/08/2025", period: 2, code: "947" },
    { date: "02/08/2025", period: 3, code: "532" },
    { date: "04/08/2025", period: 1, code: "199" },
    { date: "04/08/2025", period: 2, code: "367" },
    { date: "05/08/2025", period: 1, code: "645" },
    { date: "05/08/2025", period: 2, code: "751" },
    { date: "06/08/2025", period: 1, code: "460" },
    { date: "06/08/2025", period: 2, code: "528" },
    { date: "06/08/2025", period: 3, code: "389" },
    { date: "07/08/2025", period: 1, code: "310" },
    { date: "07/08/2025", period: 2, code: "799" },
    { date: "07/08/2025", period: 3, code: "201" },
    { date: "08/08/2025", period: 1, code: "634" },
    { date: "08/08/2025", period: 2, code: "555" },
    { date: "08/08/2025", period: 3, code: "988" },
    { date: "09/08/2025", period: 1, code: "103" },
    { date: "09/08/2025", period: 2, code: "761" },
    { date: "09/08/2025", period: 3, code: "274" },
    { date: "11/08/2025", period: 1, code: "334" },
    { date: "11/08/2025", period: 2, code: "601" },
    { date: "12/08/2025", period: 1, code: "408" },
    { date: "12/08/2025", period: 2, code: "956" }
  ];

  const now = new Date();
  const day = now.getDay(); // 0 = Sun, ..., 6 = Sat
  const hours = now.getHours();
  const minutes = now.getMinutes();

  const dateStr = now.toLocaleDateString("en-GB", { timeZone: "Asia/Kolkata" }).replace(/\//g, "/");

  let period = null;
  if ((hours === 10 && minutes >= 30) || (hours === 11 && minutes < 15)) period = 1;
  else if (hours === 12 && minutes < 45) period = 2;
  else if ((day >= 3 && day <= 6) && ((hours === 13 && minutes >= 30) || (hours === 14 && minutes < 15))) period = 3;

  if (!period) return "CLOSED";

  for (let entry of schedule) {
    if (entry.date === dateStr && entry.period === period) return entry.code;
  }

  return "CLOSED";
}
  const formSchedule = {
    "Monday":    [{ start: "10:30", end: "11:45" }, { start: "20:00", end: "22:45" }],
    "Tuesday":   [{ start: "08:30", end: "11:15" }, { start: "12:00", end: "12:45" }],
    "Wednesday": [{ start: "10:30", end: "11:15" }, { start: "12:00", end: "12:45" }, { start: "13:30", end: "14:15" }],
    "Thursday":  [{ start: "10:30", end: "11:15" }, { start: "12:00", end: "12:45" }, { start: "13:30", end: "14:15" }],
    "Friday":    [{ start: "10:30", end: "11:15" }, { start: "12:00", end: "12:45" }, { start: "13:30", end: "14:15" }],
    "Saturday":  [{ start: "10:30", end: "11:15" }, { start: "12:00", end: "12:45" }, { start: "13:30", end: "14:15" }]
  };

  let todayCode = "";

  function isFormOpenNow() {
    const now = new Date();
    const day = now.toLocaleDateString("en-US", { weekday: "long", timeZone: "Asia/Kolkata" });
    const timeNow = now.toLocaleTimeString("en-GB", { hour: "2-digit", minute: "2-digit", hour12: false, timeZone: "Asia/Kolkata" });
    const schedule = formSchedule[day];
    if (!schedule) return false;
    return schedule.some(slot => timeNow >= slot.start && timeNow <= slot.end);
  }

  function disableFields(disabled) {
    document.getElementById('roll').disabled = disabled;
    document.getElementById('confirm').disabled = disabled;
    document.querySelector('button[type="submit"]').disabled = disabled;
  }

  window.onload = function () {
    setTimeout(() => {
      document.getElementById('preloader').classList.add('fade-out');
      document.getElementById('main-content').classList.add('visible');
    }, 1500);

    const mainContent = document.getElementById('main-content');
    if (!isFormOpenNow()) {
      mainContent.innerHTML = "<h2 style='color: red;'>The attendance form is currently closed.<br>Please check your class schedule.</h2>";
      return;
    }

    const rollInput = document.getElementById('roll');
    const nameInput = document.getElementById('name');
    const dropdownSelected = document.getElementById('dropdownSelected');
    const dropdownOptions = document.getElementById('dropdownOptions');
    const dropdown = document.getElementById('customDropdown');

    Object.keys(rollToName).sort((a, b) => a - b).forEach(roll => {
      const div = document.createElement('div');
      div.textContent = roll;
      div.dataset.value = roll;
      dropdownOptions.appendChild(div);
    });

    dropdownSelected.addEventListener('click', () => {
      dropdownOptions.classList.toggle('show');
    });

    dropdownOptions.addEventListener('click', e => {
      if (e.target.dataset.value) {
        const roll = e.target.dataset.value;
        rollInput.value = roll;
        dropdownSelected.textContent = roll;
        nameInput.value = rollToName[roll] || '';
        dropdownOptions.classList.remove('show');
      }
    });

    document.addEventListener('click', (e) => {
      if (!dropdown.contains(e.target)) {
        dropdownOptions.classList.remove('show');
      }
    });

    todayCode = getSecurityCode();

    disableFields(true);

    document.getElementById('code').addEventListener('input', function () {
      const inputCode = this.value.trim().toUpperCase();
      if (inputCode === todayCode) {
        document.getElementById('codeError').classList.add('hidden');
        disableFields(false);
      } else {
        disableFields(true);
        document.getElementById('codeError').classList.remove('hidden');
      }
    });

    document.getElementById('attendanceForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const codeInput = document.getElementById('code').value.trim().toUpperCase();
      if (codeInput !== todayCode) {
        document.getElementById('codeError').classList.remove('hidden');
        return;
      }

      const confirmed = confirm("Attendance submitted successfully. Click OK to proceed.");
      if (confirmed) {
        document.getElementById('attendanceForm').submit();
        setTimeout(() => {
          window.location.href = "THANKS.html";
        }, 1000);
      } else {
        setTimeout(() => {
          document.getElementById('attendanceForm').reset();
          nameInput.value = "";
          dropdownSelected.textContent = "Select Roll Number";
          disableFields(true);
        }, 500);
      }
    });
  };
</script>
</body>
</html>
